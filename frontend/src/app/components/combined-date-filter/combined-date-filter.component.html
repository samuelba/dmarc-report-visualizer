<div class="combined-date-filter">
  <mat-form-field appearance="outline" subscriptSizing="dynamic" class="display-field">
    <mat-label>Date Filter</mat-label>
    <input
      matInput
      [value]="getDisplayText()"
      readonly
      [matMenuTriggerFor]="filterMenu"
      #menuTrigger="matMenuTrigger"
      style="cursor: pointer"
    />
  </mat-form-field>

  <mat-menu #filterMenu="matMenu" [class]="'combined-date-filter-menu'">
    <div
      class="menu-content"
      (click)="$event.stopPropagation()"
      (keydown)="$event.stopPropagation()"
      role="menu"
      tabindex="0"
    >
      <div class="mode-selector">
        <mat-radio-group [(ngModel)]="tempMode" (change)="onModeChange()">
          <mat-radio-button value="period">Time Period</mat-radio-button>
          <mat-radio-button value="range">Date Range</mat-radio-button>
        </mat-radio-group>
      </div>

      <div class="filter-content">
        <!-- Time Period Mode -->
        <div *ngIf="tempMode === 'period'" class="period-mode">
          <mat-form-field appearance="outline" subscriptSizing="dynamic">
            <mat-label>Time Period</mat-label>
            <input
              matInput
              [(ngModel)]="tempPeriodInput"
              placeholder="e.g. 30, 7d, 4m, 5y, or 'all'"
              (keydown.enter)="applyFilter()"
            />
            <mat-hint>Format: number (days) or Xd/Xm/Xy or 'all'</mat-hint>
          </mat-form-field>

          <div class="quick-options">
            <button matButton="outlined" (click)="selectQuickPeriod('7d')">Last 7 days</button>
            <button matButton="outlined" (click)="selectQuickPeriod('30d')">Last 30 days</button>
            <button matButton="outlined" (click)="selectQuickPeriod('3m')">Last 3 months</button>
            <button matButton="outlined" (click)="selectQuickPeriod('6m')">Last 6 months</button>
            <button matButton="outlined" (click)="selectQuickPeriod('1y')">Last year</button>
            <button matButton="outlined" (click)="selectQuickPeriod('all')">All time</button>
          </div>
        </div>

        <!-- Date Range Mode -->
        <div *ngIf="tempMode === 'range'" class="range-mode">
          <mat-form-field appearance="outline" subscriptSizing="dynamic">
            <mat-label>Enter a date range</mat-label>
            <mat-date-range-input [rangePicker]="rangePicker">
              <input matStartDate [(ngModel)]="tempFromDate" placeholder="Start date" />
              <input matEndDate [(ngModel)]="tempToDate" placeholder="End date" />
            </mat-date-range-input>
            <mat-datepicker-toggle matIconSuffix [for]="rangePicker"></mat-datepicker-toggle>
            <mat-date-range-picker #rangePicker></mat-date-range-picker>
          </mat-form-field>
        </div>
      </div>

      <div class="menu-actions">
        <button matButton="text" (click)="clearFilter()">Clear</button>
        <button matButton="filled" color="primary" (click)="applyFilter()">Apply</button>
      </div>
    </div>
  </mat-menu>
</div>
