<h2 mat-dialog-title>
  <mat-icon>{{ data.mode === 'create' ? 'add' : 'edit' }}</mat-icon>
  {{ data.mode === 'create' ? 'Add' : 'Edit' }} Third-Party Sender
</h2>

<mat-dialog-content>
  <div class="form-container">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Name</mat-label>
      <input matInput [(ngModel)]="formData.name" placeholder="e.g., SendGrid, Mailgun" required />
      <mat-hint>A descriptive name for this sender</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Description</mat-label>
      <textarea matInput [(ngModel)]="formData.description" placeholder="Optional description..." rows="2"> </textarea>
      <mat-hint>When and why this sender is used</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>DKIM Pattern (Regex)</mat-label>
      <input
        matInput
        [(ngModel)]="formData.dkimPattern"
        placeholder="e.g., .*\\.sendgrid\\.net$"
        (blur)="validateRegex('dkim')"
      />
      <mat-icon matSuffix matTooltip="Regular expression to match DKIM domains">help</mat-icon>
      <mat-hint>Regex pattern to match DKIM authentication domains</mat-hint>
      @if (dkimError()) {
        <mat-error>{{ dkimError() }}</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>SPF Pattern (Regex)</mat-label>
      <input
        matInput
        [(ngModel)]="formData.spfPattern"
        placeholder="e.g., .*\\.sendgrid\\.net$"
        (blur)="validateRegex('spf')"
      />
      <mat-icon matSuffix matTooltip="Regular expression to match SPF domains">help</mat-icon>
      <mat-hint>Regex pattern to match SPF authentication domains</mat-hint>
      @if (spfError()) {
        <mat-error>{{ spfError() }}</mat-error>
      }
    </mat-form-field>

    <div class="toggle-container">
      <mat-slide-toggle [(ngModel)]="formData.enabled" color="primary"> Enabled </mat-slide-toggle>
      <span class="toggle-hint">Active rules will be applied during forwarding detection</span>
    </div>

    <div class="help-section">
      <strong>ðŸ’¡ Pattern Examples:</strong>
      <ul>
        <li><code>.*\\.sendgrid\\.net$</code> - Matches any sendgrid.net subdomain</li>
        <li><code>^mail\\..*\\.com$</code> - Matches mail.*.com</li>
        <li><code>.*(sendgrid|mailgun)\\..*</code> - Matches domains containing sendgrid or mailgun</li>
      </ul>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button matButton="text" (click)="cancel()">Cancel</button>
  <button matButton="filled" color="primary" (click)="save()" [disabled]="!isValid() || saving()">
    @if (saving()) {
      Saving...
    } @else {
      {{ data.mode === 'create' ? 'Create' : 'Update' }}
    }
  </button>
</mat-dialog-actions>
