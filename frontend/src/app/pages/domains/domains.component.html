<div class="domains-container">
  <div class="page-header">
    <p class="subtitle">Manage your domains and review authentication statistics</p>
    <div class="layout-toggle">
      <button
        mat-icon-button
        [matTooltip]="layoutMode === 'grid' ? 'Switch to list view' : 'Switch to grid view'"
        (click)="toggleLayout()"
      >
        <mat-icon>{{ layoutMode === 'grid' ? 'view_list' : 'view_module' }}</mat-icon>
      </button>
    </div>
  </div>

  <!-- Time Period Selector -->
  <section class="filters">
    <div class="filter-controls">
      <mat-form-field appearance="outline" subscriptSizing="dynamic">
        <mat-label>Time Period</mat-label>
        <mat-select [(ngModel)]="daysBack" (selectionChange)="onDaysBackChange()">
          <mat-option [value]="7">Last 7 days</mat-option>
          <mat-option [value]="14">Last 14 days</mat-option>
          <mat-option [value]="30">Last 30 days</mat-option>
          <mat-option [value]="60">Last 60 days</mat-option>
          <mat-option [value]="90">Last 90 days</mat-option>
          <mat-option [value]="180">Last 180 days</mat-option>
          <mat-option [value]="365">Last 365 days</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </section>

  <!-- Loading Spinner -->
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
  }

  <!-- Managed Domains Section -->
  @if (!loading()) {
    <div class="domains-section">
      <div class="section-header">
        <h2>
          <mat-icon>check_circle</mat-icon>
          Managed Domains
        </h2>
        <button matButton="tonal" color="primary" (click)="openAddDomainDialog()">
          <mat-icon>add</mat-icon>
          Add Domain
        </button>
      </div>
      <p class="section-description">
        These are the domains you have added to your list. They represent legitimate sending domains that you own or
        manage.
      </p>

      @if (managedDomains.length === 0) {
        <mat-card class="empty-state">
          <mat-card-content>
            <mat-icon>inbox</mat-icon>
            <p>No managed domains yet</p>
            <p class="hint">Click "Add Domain" to start tracking your sending domains</p>
          </mat-card-content>
        </mat-card>
      }

      <div [class]="layoutMode === 'grid' ? 'domains-grid' : 'domains-list'" *ngIf="managedDomains.length > 0">
        @for (stat of managedDomains; track stat) {
          @if (layoutMode === 'grid') {
            <app-domain-card
              [domain]="stat"
              [isManaged]="true"
              [daysBack]="daysBack"
              (edit)="editDomain($event)"
              (remove)="removeDomain($event)"
            ></app-domain-card>
          } @else {
            <app-domain-list-item
              [domain]="stat"
              [isManaged]="true"
              [daysBack]="daysBack"
              (edit)="editDomain($event)"
              (remove)="removeDomain($event)"
            ></app-domain-list-item>
          }
        }
      </div>
    </div>
  }

  <!-- Unknown Domains Section -->
  @if (!loading()) {
    <div class="domains-section unknown-section">
      <div class="section-header">
        <h2>
          <mat-icon class="warning-icon">warning</mat-icon>
          Unknown Domains in Reports
        </h2>
      </div>
      <div class="warning-box">
        <mat-icon>info</mat-icon>
        <div class="warning-content">
          <p><strong>Review these domains carefully!</strong></p>
          <p>These domains appear in your DMARC reports but are not in your managed list. They could be:</p>
          <ul>
            <li><strong>Legitimate:</strong> Domains you forgot to add or subdomains you use</li>
            <li><strong>Suspicious:</strong> Phishing or spoofing attempts using your domains</li>
            <li><strong>Third-party:</strong> Services sending on your behalf</li>
          </ul>
          <p>
            If you recognize a domain, you can add it to your managed list. If you don't recognize it, investigate
            further to determine if it's a security concern.
          </p>
        </div>
      </div>

      @if (unknownDomains.length === 0) {
        <mat-card class="empty-state success">
          <mat-card-content>
            <mat-icon>check_circle</mat-icon>
            <p>No unknown domains found</p>
            <p class="hint">All domains in your reports are managed!</p>
          </mat-card-content>
        </mat-card>
      }

      <div [class]="layoutMode === 'grid' ? 'domains-grid' : 'domains-list'" *ngIf="unknownDomains.length > 0">
        @for (stat of unknownDomains; track stat) {
          @if (layoutMode === 'grid') {
            <app-domain-card
              [domain]="stat"
              [isManaged]="false"
              [daysBack]="daysBack"
              (addToManaged)="addUnknownDomain($event)"
            ></app-domain-card>
          } @else {
            <app-domain-list-item
              [domain]="stat"
              [isManaged]="false"
              [daysBack]="daysBack"
              (addToManaged)="addUnknownDomain($event)"
            ></app-domain-list-item>
          }
        }
      </div>
    </div>
  }
</div>
