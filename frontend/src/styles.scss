@use '@angular/material' as mat;

@include mat.core();

// Define color palettes
$primary: mat.m2-define-palette(mat.$m2-blue-palette, 600);
$accent: mat.m2-define-palette(mat.$m2-green-palette, 500);
$warn: mat.m2-define-palette(mat.$m2-red-palette, 500);

// Light theme
$light-theme: mat.m2-define-light-theme(
  (
    color: (
      primary: $primary,
      accent: $accent,
      warn: $warn,
    ),
  )
);

// Dark theme
$dark-theme: mat.m2-define-dark-theme(
  (
    color: (
      primary: $primary,
      accent: $accent,
      warn: $warn,
    ),
  )
);

// Apply light theme by default
@include mat.all-component-themes($light-theme);

// Dark theme styles
.dark-theme {
  @include mat.all-component-colors($dark-theme);

  // Override Prism theme for dark mode - use Twilight
  // Hide the default light theme
  pre[class*="language-"],
  code[class*="language-"] {
    color: #f8f8f2;
    background: #141414;
    text-shadow: 0 1px rgba(0, 0, 0, 0.3);
  }

  pre[class*="language-"]::selection,
  code[class*="language-"]::selection,
  pre[class*="language-"] *::selection,
  code[class*="language-"] *::selection {
    text-shadow: none;
    background: rgba(255, 255, 255, 0.15);
  }

  pre[class*="language-"] {
    padding: 1em;
    margin: 0.5em 0;
    overflow: auto;
    border-radius: 0.3em;
    box-shadow: none !important;
  }

  :not(pre) > code[class*="language-"] {
    padding: 0.15em 0.2em 0.05em;
    border-radius: 0.3em;
    border: 0.13em solid #545454;
    box-shadow: 1px 1px 0.3em -0.1em #000 inset;
  }

  .token.comment,
  .token.prolog,
  .token.doctype,
  .token.cdata {
    color: #777;
  }

  .token.punctuation {
    color: #f8f8f2;
  }

  .token.property,
  .token.tag,
  .token.boolean,
  .token.number,
  .token.constant,
  .token.symbol,
  .token.deleted {
    color: #cf6a4c;
  }

  .token.selector,
  .token.attr-name,
  .token.string,
  .token.char,
  .token.builtin,
  .token.inserted {
    color: #8f9d6a;
  }

  .token.operator,
  .token.entity,
  .token.url,
  .language-css .token.string,
  .style .token.string {
    color: #cda869;
    background: rgba(255, 255, 255, 0.5);
  }

  .token.atrule,
  .token.attr-value,
  .token.keyword {
    color: #ac885b;
  }

  .token.function,
  .token.class-name {
    color: #9b703f;
  }

  .token.regex,
  .token.important,
  .token.variable {
    color: #e9c062;
  }

  .token.important,
  .token.bold {
    font-weight: bold;
  }

  .token.italic {
    font-style: italic;
  }

  .token.entity {
    cursor: help;
  }
}

// Global styles
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Roboto', sans-serif;
  transition:
    background-color 0.3s ease,
    color 0.3s ease;
}

// Light theme styles
.light-theme {
  background-color: #fafafa;
  color: #333;

  // Custom component backgrounds
  .dashboard-content {
    background-color: #f5f5f5;
  }

  .explore {
    background-color: #ffffff;
  }

  // Style the actual text field wrapper (where the dropdown background should be)
  .mat-mdc-text-field-wrapper {
    background-color: #ffffff !important;
  }

  // Card backgrounds
  mat-card {
    background-color: #ffffff;
    color: #333;
  }

  // Table backgrounds
  .mat-mdc-table {
    background-color: #ffffff;
  }

  .mat-mdc-row:hover {
    background-color: #f5f5f5;
  }

  // Form field backgrounds
  .mat-mdc-form-field {
    .mat-mdc-form-field-flex {
      background-color: #ffffff;
    }
  }

  // Toolbar
  .app-toolbar {
    background-color: mat.get-theme-color($light-theme, primary, 600) !important;
  }

  // XML viewer light theme specific overrides
  .xml-viewer-dialog {
    pre {
      padding-top: 0 !important;
    }

    code {
      padding: 0 !important;
    }

    // Solarized Light theme colors for Prism
    pre[class*="language-"],
    code[class*="language-"] {
      color: #657b83;
      background: #ffffff;
      text-shadow: 0 1px white;
    }

    pre[class*="language-"]::selection,
    code[class*="language-"]::selection,
    pre[class*="language-"] *::selection,
    code[class*="language-"] *::selection {
      background: #073642;
    }

    pre[class*="language-"] {
      margin: 0.5em 0;
      overflow: auto;
      border-radius: 0.3em;
      box-shadow: none !important;
    }

    :not(pre) > code[class*="language-"] {
      padding: 0.15em 0.2em 0.05em;
      border-radius: 0.3em;
      border: 0.13em solid #c5c8c6;
    }

    .token.comment,
    .token.prolog,
    .token.doctype,
    .token.cdata {
      color: #93a1a1;
    }

    .token.punctuation {
      color: #586e75;
    }

    .token.property,
    .token.tag,
    .token.boolean,
    .token.number,
    .token.constant,
    .token.symbol,
    .token.deleted {
      color: #268bd2;
    }

    .token.selector,
    .token.attr-name,
    .token.string,
    .token.char,
    .token.builtin,
    .token.url,
    .token.inserted {
      color: #2aa198;
    }

    .token.entity {
      color: #657b83;
      background: #eee8d5;
      cursor: help;
    }

    .token.atrule,
    .token.attr-value,
    .token.keyword {
      color: #859900;
    }

    .token.function,
    .token.class-name {
      color: #b58900;
    }

    .token.regex,
    .token.important,
    .token.variable {
      color: #cb4b16;
    }

    .token.important,
    .token.bold {
      font-weight: bold;
    }

    .token.italic {
      font-style: italic;
    }

    // Line numbers styling for light theme
    .line-numbers-rows {
      border-right-color: #e0e0e0 !important;
    }

    .line-numbers-rows > span:before {
      color: #93a1a1 !important;
    }

    // Line highlight styling for light theme
    .line-highlight {
      background: rgba(255, 193, 7, 0.2) !important;
    }

    .line-highlight:before,
    .line-highlight[data-end]:after {
      background-color: #ffc107 !important;
      color: #000 !important;
    }
  }
}

// Dark theme styles
.dark-theme {
  background-color: #121212;
  color: #e0e0e0;

  // Custom component backgrounds
  .dashboard-content {
    background-color: #121212;
  }

  .explore {
    background-color: #121212;
  }

  // Card backgrounds - higher contrast
  mat-card {
    background-color: #2d2d2d;
    color: #e0e0e0;
    border: 1px solid #404040;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
  }

  // Table backgrounds
  .mat-mdc-table {
    background-color: #2d2d2d;
    color: #e0e0e0;
    border: 1px solid #404040;
  }

  .mat-mdc-row:hover {
    background-color: #3a3a3a;
  }

  .mat-mdc-header-row {
    background-color: #3a3a3a;
  }

  // Form field backgrounds
  .mat-mdc-form-field {
    .mat-mdc-form-field-flex {
      background-color: #2d2d2d;
      border: none; // rely on notched outline border to avoid double border
    }

    // Style the actual text field wrapper (where the dropdown background should be)
    .mat-mdc-text-field-wrapper {
      background-color: #2d2d2d !important;
    }

    .mat-mdc-form-field-outline {
      color: #666;
    }

    // Fix the notched outline parts
    .mdc-notched-outline {
      .mdc-notched-outline__leading,
      .mdc-notched-outline__notch,
      .mdc-notched-outline__trailing {
        border-color: #404040 !important;
        background-color: transparent !important; // Don't cover the arrow
      }
    }

    // Ensure notch left border matches outline (avoid transparent seam) - high specificity to override Material defaults
    &.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field
      .mdc-notched-outline__notch {
      border-left: 0px solid #404040 !important;
    }

    // Remove any default borders from the outline
    .mdc-notched-outline__leading,
    .mdc-notched-outline__notch,
    .mdc-notched-outline__trailing {
      border-color: #404040 !important;
      background-color: #2d2d2d !important;
    }

    // Form field infix (inner content area)
    .mat-mdc-form-field-infix {
      background-color: #2d2d2d !important;
    }

    // Remove focus overlay tint that can create mismatched shades
    .mat-mdc-form-field-focus-overlay {
      background: transparent !important;
    }
  }

  // Input backgrounds
  .mat-mdc-input-element {
    color: #e0e0e0;
  }

  // Select backgrounds
  .mat-mdc-select-value {
    color: #e0e0e0;
  }

  // Make the select arrow visible in dark mode - override currentColor
  .mat-mdc-select-arrow-wrapper {
    opacity: 1 !important;
    color: #e0e0e0 !important; // Set currentColor context
  }

  .mat-mdc-select-arrow {
    opacity: 1 !important;
    color: #e0e0e0 !important; // Set currentColor context
  }

  .mat-mdc-select-arrow svg {
    fill: #e0e0e0 !important; // Override currentColor
    color: #e0e0e0 !important;
    opacity: 1 !important;
  }

  .mat-mdc-select-arrow svg path {
    fill: #e0e0e0 !important; // Override currentColor
    stroke: #e0e0e0 !important;
  }

  // Also ensure the select trigger has the right color for currentColor inheritance
  .mat-mdc-select-trigger {
    color: #e0e0e0 !important;
  }

  // Dark mode for IP cell code elements
  .ip-cell code {
    background-color: #404040 !important;
    color: #e0e0e0 !important;
  }

  // Select dropdown panel
  .mat-mdc-select-panel {
    background-color: #2d2d2d !important;
    border: 1px solid #404040 !important;
  }

  // Select options
  .mat-mdc-option {
    background-color: #2d2d2d !important;
    color: #e0e0e0 !important;
  }

  .mat-mdc-option:hover {
    background-color: #3a3a3a !important;
  }

  .mat-mdc-option.mdc-list-item--selected {
    background-color: #404040 !important;
  }

  // Dropdown overlay
  .cdk-overlay-pane {
    .mat-mdc-select-panel {
      background-color: #2d2d2d !important;
    }
  }

  // Toolbar
  .app-toolbar {
    background-color: #1e1e1e !important;
  }

  // Spinner
  .mat-mdc-progress-spinner circle {
    stroke: #e0e0e0;
  }

  // Buttons
  .mat-mdc-button {
    color: #e0e0e0;
  }

  // Icons
  .mat-icon {
    color: #e0e0e0;
  }

  // Detail content
  .detail-content {
    background-color: #3a3a3a !important;
    color: #e0e0e0;
    border-top: 1px solid #555 !important;
  }

  .detail-section h4 {
    color: #e0e0e0 !important;
    border-bottom: 1px solid #555 !important;
  }

  // Chart backgrounds
  .chart {
    background-color: #2d2d2d;
    border: 1px solid #404040;
    border-radius: 4px;
  }

  // Loading container
  .loading-container {
    color: #e0e0e0;
  }

  // No issues state
  .no-issues {
    color: #4caf50;
  }

  // Country items
  .country-item {
    background-color: #3a3a3a !important;
    border: 1px solid #4a4a4a !important;
  }

  // Header-From items - match country items styling
  .headerfrom-item {
    background-color: #3a3a3a !important;
    border: 1px solid #4a4a4a !important;
  }

  // DNS issue items
  .dns-issue-item {
    background-color: #3a3a3a !important;
    border: 1px solid #4a4a4a !important;
  }

  // Auth issue items
  .auth-issue-item {
    background-color: #3a3a3a !important;
    border: 1px solid #4a4a4a !important;
  }

  // Insights
  .insight-item {
    background-color: #3a3a3a !important;
    border: 1px solid #4a4a4a !important;

    // Text elements within insights
    h4 {
      color: #e0e0e0 !important;
    }

    p {
      color: #b0b0b0 !important;
    }

    div {
      color: #b0b0b0 !important;
    }

    strong {
      color: #e0e0e0 !important;
    }
  }

  // Map controls
  .map-controls {
    background-color: #3a3a3a !important;
    border: 1px solid #4a4a4a !important;
    color: #e0e0e0;
  }

  // Map loading overlay
  .loading-overlay {
    background: rgba(18, 18, 18, 0.8) !important;
    color: #e0e0e0;
  }

  // XML viewer dialog
  .xml-viewer-dialog {
    .dialog-header {
      background-color: #2d2d2d;
      border-bottom-color: #404040;
    }

    h2[mat-dialog-title] {
      color: #e0e0e0;
    }

    .xml-container {
      background-color: #1e1e1e;
    }

    pre {
      background-color: #2d2d2d !important;
      border-color: #404040 !important;
      color: #e0e0e0 !important;
      padding-top: 0 !important;
    }

    code {
      padding: 0 !important;
    }

    // PrismJS token styling for dark theme
    .token.tag {
      color: #569cd6 !important;
    }

    .token.attr-name {
      color: #9cdcfe !important;
    }

    .token.attr-value {
      color: #ce9178 !important;
    }

    .token.punctuation {
      color: #d4d4d4 !important;
    }

    .token.comment {
      color: #6a9955 !important;
    }

    // Line numbers styling for dark theme
    .line-numbers-rows {
      border-right-color: #404040 !important;
    }

    .line-numbers-rows > span:before {
      color: #858585 !important;
    }

    // Line highlight styling for dark theme
    .line-highlight {
      background: rgba(255, 193, 7, 0.15) !important;
      //background: linear-gradient(to right, rgba(255, 193, 7, 0.15) 70%, rgba(255, 193, 7, 0)) !important;
    }

    .line-highlight:before,
    .line-highlight[data-end]:after {
      background-color: #ffc107 !important;
      color: #000 !important;
    }
  }

  // Dialog overlay
  .cdk-overlay-dark-backdrop {
    background: rgba(0, 0, 0, 0.6);
  }
}

// Leaflet styles for maps
@import 'leaflet/dist/leaflet.css';

// Custom utility classes
.full-width {
  width: 100%;
}

.text-center {
  text-align: center;
}

.loading-spinner {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

// Custom popup styles for Leaflet
.popup-content {
  font-family: 'Roboto', sans-serif;
}

.light-theme .popup-content {
  h4 {
    margin: 0 0 8px;
    color: #333;
    font-size: 14px;
  }

  p {
    margin: 4px 0;
    font-size: 12px;
    color: #666;
  }
}

.dark-theme .popup-content {
  h4 {
    margin: 0 0 8px;
    color: #e0e0e0;
    font-size: 14px;
  }

  p {
    margin: 4px 0;
    font-size: 12px;
    color: #b0b0b0;
  }
}

// Dark mode support for Leaflet map tiles
.dark-theme .leaflet-tile {
  filter: brightness(0.6) invert(1) contrast(3) hue-rotate(200deg) saturate(0.3) brightness(0.7);
}

// XML Viewer Dialog Styling
.xml-viewer-dialog {
  .dialog-header {
    background-color: #f5f5f5;
  }

  .xml-container {
    background-color: #f9f9f9;
  }

  pre {
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    padding-top: 0 !important;
  }

  code {
    padding: 0 !important;
  }
}

// Light theme PrismJS customization
.light-theme {
  .token.tag {
    color: #800000 !important;
  }

  .token.attr-name {
    color: #ff0000 !important;
  }

  .token.attr-value {
    color: #0000ff !important;
  }
}
